
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* æ²‰æµ¸å¼åŠ¨æ€èƒŒæ™¯ */
        body {

              /* æŸ”å’Œçš„é©¬å¡é¾™æ¸å˜èƒŒæ™¯ */
                 background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff); 
            margin: 0; padding: 0; width: 100vw; height: 100vh;
            background-size: cover; background-position: center;
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex; align-items: center; justify-content: center; color: #fff;
            transition: background 0.8s ease; 
        }
        .container {
            width: 90%; max-width: 450px; background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px); padding: 30px; border-radius: 28px;
            border: 1px solid rgba(255, 255, 255, 0.1); text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }
        .search-box { display: flex; gap: 10px; margin-bottom: 25px; }
        input[type="text"] {
            flex: 1; padding: 14px; border-radius: 12px; border: 1px solid #444;
            background: rgba(0,0,0,0.5); color: #fff; outline: none; font-size: 1rem;
        }
        button {
            padding: 0 20px; background: #e94560; color: white; border: none;
            border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        button:hover { background: #ff5e78; transform: scale(1.05); }

        #resultArea { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 20px; text-align: left; display: none; }
        .rating { color: #f1c40f; font-weight: bold; font-size: 1.2rem; }
        .desc { font-size: 0.85rem; color: #ddd; line-height: 1.6; margin: 15px 0; max-height: 100px; overflow-y: auto; }
        
        /* æ’­æ”¾æºæ ·å¼ä¼˜åŒ– */
        .provider-section { margin-bottom: 20px; padding: 12px; background: rgba(0, 210, 255, 0.1); border-radius: 12px; }
        .provider-title { font-size: 0.8rem; color: #00d2ff; font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }
        .provider-list { display: flex; gap: 12px; flex-wrap: wrap; }
        .provider-link { transition: transform 0.2s; display: inline-block; }
        .provider-link:hover { transform: translateY(-3px) scale(1.1); }
        .provider-img { width: 40px; height: 40px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }

        /* æ¼”å‘˜åˆ—è¡¨ */
        .cast-scroll { display: flex; overflow-x: auto; gap: 12px; scrollbar-width: none; }
        .cast-item { flex: 0 0 60px; text-align: center; font-size: 0.7rem; }
        .cast-img { width: 55px; height: 55px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(233, 69, 96, 0.4); }
    </style>
</head>
<body>

<div class="container">
    <h2 style="color: #e94560; margin-top: 0;">ğŸ¬ å½±è¿·ç™¾ç§‘æœç´¢</h2>
    <div class="search-box">
        <input type="text" id="keywordInput" placeholder="è¾“å…¥å½±è§†å‰§ã€åŠ¨æ¼«åç§°...">
        <button id="searchBtn">æœç´¢</button>
    </div>

    <div id="resultArea">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <b id="mTitle" style="font-size: 1.3rem;"></b>
            <span id="mRating" class="rating"></span>
        </div>
        <div id="mYear" style="font-size: 0.75rem; color: #888; margin-top: 4px;"></div>
        
        <p id="mDesc" class="desc"></p>

        <div id="providerSection" class="provider-section" style="display: none;">
            <div class="provider-title">ğŸ“º ç«‹å³æ’­æ”¾ (ç‚¹å‡»å¹³å°å›¾æ ‡è·³è½¬)</div>
            <div class="provider-list" id="providerList"></div>
        </div>
        
        <div style="font-size: 0.85rem; color: #e94560; font-weight: bold; margin-bottom: 10px;">ğŸŒŸ é¢†è¡”ä¸»æ¼”</div>
        <div class="cast-scroll" id="castList"></div>
    </div>
</div>

<script>
    const TMDB_KEY = 'a2a3fdd1a00d32cca3550a8884a82327';
    const keywordInput = document.getElementById('keywordInput');
    const searchBtn = document.getElementById('searchBtn');

    searchBtn.onclick = startSearch;
    keywordInput.onkeypress = (e) => e.key === 'Enter' && startSearch();

    async function startSearch() {
        const kw = keywordInput.value.trim();
        if (!kw) return;
        searchBtn.innerText = "...";
        searchBtn.disabled = true;

        try {
            const resp = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB_KEY}&query=${encodeURIComponent(kw)}&language=zh-CN`);
            const data = await resp.json();
            if (data.results && data.results.length > 0) {
                await showResult(data.results[0]);
            } else {
                alert("æœªæ‰¾åˆ°ç›¸å…³å½±è§†å†…å®¹");
            }
        } catch (e) {
            alert("ç½‘ç»œè¿æ¥å¤±è´¥");
        } finally {
            searchBtn.innerText = "æœç´¢";
            searchBtn.disabled = false;
        }
    }

    async function showResult(item) {
        const resultArea = document.getElementById('resultArea');
        resultArea.style.display = 'block';

        // 1. è®¾ç½®é«˜æ¸…èƒŒæ™¯å›¾
        if (item.backdrop_path) {
            document.body.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://image.tmdb.org/t/p/original${item.backdrop_path}')`;
        }

        document.getElementById('mTitle').innerText = item.title || item.name;
        document.getElementById('mRating').innerText = "â˜… " + (item.vote_average || 0).toFixed(1);
        document.getElementById('mYear').innerText = "ğŸ“… " + (item.release_date || item.first_air_date || "å¹´ä»½æœªçŸ¥");
        document.getElementById('mDesc').innerText = item.overview || "æš‚æ— è¯¦ç»†ç®€ä»‹å†…å®¹ã€‚";

        const type = item.media_type === 'tv' ? 'tv' : 'movie';

        // 2. è·å–æ’­æ”¾æºå¹¶ç”Ÿæˆè·³è½¬é“¾æ¥
        const pResp = await fetch(`https://api.themoviedb.org/3/${type}/${item.id}/watch/providers?api_key=${TMDB_KEY}`);
        const pData = await pResp.json();
        
        const regionData = pData.results?.CN; // é»˜è®¤ä¸­å›½åŒº
        const providers = regionData?.flatrate || []; 
        const jumpLink = regionData?.link; // JustWatch èšåˆè·³è½¬é“¾æ¥

        const providerSection = document.getElementById('providerSection');
        const providerList = document.getElementById('providerList');
        providerList.innerHTML = '';
        
        if (providers.length > 0) {
            providerSection.style.display = 'block';
            providers.forEach(p => {
                const a = document.createElement('a');
                a.href = jumpLink;
                a.target = "_blank";
                a.className = "provider-link";

                const img = document.createElement('img');
                img.className = 'provider-img';
                img.src = `https://image.tmdb.org/t/p/original${p.logo_path}`;
                img.title = `åœ¨ ${p.provider_name} è§‚çœ‹`;
                
                a.appendChild(img);
                providerList.appendChild(a);
            });
        } else {
            providerSection.style.display = 'none';
        }

        // 3. æ¸²æŸ“æ¼”å‘˜è¡¨
        const cResp = await fetch(`https://api.themoviedb.org/3/${type}/${item.id}/credits?api_key=${TMDB_KEY}&language=zh-CN`);
        const cData = await cResp.json();
        const list = document.getElementById('castList');
        list.innerHTML = '';
        cData.cast.slice(0, 8).forEach(p => {
            const div = document.createElement('div');
            div.className = 'cast-item';
            const img = p.profile_path ? 'https://image.tmdb.org/t/p/w200' + p.profile_path : 'https://via.placeholder.com/55/333/fff?text=?';
            div.innerHTML = `<img src="${img}" class="cast-img"><div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${p.name}</div>`;
            list.appendChild(div);
        });
    }
</script>
</body>
</html>
