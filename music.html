<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自定义链接音乐播放器</title>
    <style>
        :root {
            --primary-color: #007bff; /* 蓝色主题 */
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #343a40;
            --progress-track: #e9ecef;
        }

        /* --- 整体布局与卡片样式 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;

                 background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff);

        }

        .audio-card {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 450px;
            text-align: center;
                 background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff);

        }

        .track-info { margin-bottom: 20px; }
        .track-info h2 { margin: 0; color: var(--text-color); font-size: 1.25rem; }

        /* 隐藏原生 audio 元素 */
        audio { display: none; }

        /* --- URL 输入区域样式 --- */
        .url-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        #audioUrlInput {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        #loadBtn {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }
        #loadBtn:hover { background-color: #0056b3; }

        /* --- 播放器控件样式 --- */
        .player-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            padding: 10px;
            border-top: 1px solid #e9ecef;
        }

        #playPauseBtn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            line-height: 1;
            cursor: pointer;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }
        #playPauseBtn:hover:not(:disabled) { background-color: #0056b3; }
        #playPauseBtn:disabled { opacity: 0.6; cursor: not-allowed; }
        
        .progress-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 5px;
        }

        /* 进度条样式 */
        #progressBar {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: var(--progress-track);
            border-radius: 3px;
            cursor: pointer;
            margin: 0;
        }
        #progressBar::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 14px;
            width: 14px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            margin-top: -4px; 
        }

        #timeDisplay {
            font-size: 0.75rem;
            color: #6c757d;
            text-align: left;
        }

        /* --- 音量控制样式 --- */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 5px;
            width: 80px; /* 限制音量控制的宽度 */
            flex-shrink: 0;
        }
        #volumeSlider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px; /* 比进度条细 */
            background: var(--progress-track);
            border-radius: 2px;
            cursor: pointer;
            margin: 0;
        }
        #volumeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            margin-top: -4px; 
        }

        .icon { width: 16px; height: 16px; }

        /* 提示框 (Toast) 样式 */
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 12px; position: fixed; z-index: 1; bottom: 30px; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; }
        #toast.show { visibility: visible; opacity: 1; }
    </style>
</head>
<body>

    <div class="audio-card">
        <div class="track-info">
            <h2 id="currentTrackTitle">加载自定义音频链接</h2>
        </div>

        <div class="url-input-group">
            <input type="url" id="audioUrlInput" placeholder="在此输入音频（MP3/WAV）链接" 
                   value="">
            <button id="loadBtn">加载</button>
        </div>

        <audio id="audioPlayer"></audio>

        <div class="player-controls">
            <button id="playPauseBtn" disabled>▶</button> 
            
            <div class="progress-container">
                <input type="range" id="progressBar" value="0" min="0" max="100" disabled>
                <div id="timeDisplay">0:00 / 0:00</div>
            </div>

            <div class="volume-control">
                <svg class="icon" id="volumeIcon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464A6 6 0 0118 12.5c0 1.636-.61 3.14-1.618 4.25M12 4v4m0 8v4m-5.464-1.536A6 6 0 006 12.5c0-1.636.61-3.14 1.618-4.25M4 12.5h4m8 0h4m-7 0a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                <input type="range" id="volumeSlider" min="0" max="100" value="100" disabled>
            </div>
        </div>
        </div>

    <div id="toast"></div>

    <script>
        // --- 核心元素引用 ---
        const audio = document.getElementById('audioPlayer');
        const urlInput = document.getElementById('audioUrlInput');
        const loadBtn = document.getElementById('loadBtn');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const progressBar = document.getElementById('progressBar');
        const timeDisplay = document.getElementById('timeDisplay');
        const currentTrackTitleEl = document.getElementById('currentTrackTitle');
        const volumeSlider = document.getElementById('volumeSlider');

        let currentAudioUrl = '';

        // 启用/禁用所有播放器控制按钮
        function setControlsDisabled(disabled) {
            playPauseBtn.disabled = disabled;
            progressBar.disabled = disabled;
            volumeSlider.disabled = disabled;
        }

        // --- 0. 音量初始化及控制 ---
        
        // 尝试从本地存储加载上次设置的音量
        const savedVolume = localStorage.getItem('playerVolume');
        if (savedVolume !== null) {
            const initialVolume = parseFloat(savedVolume);
            audio.volume = initialVolume;
            volumeSlider.value = initialVolume * 100;
        } else {
            audio.volume = 1.0; // 默认满音量
        }

        // 监听音量滑块变化
        volumeSlider.addEventListener('input', () => {
            const volumeLevel = volumeSlider.value / 100;
            audio.volume = volumeLevel;
            // 存储音量设置
            localStorage.setItem('playerVolume', volumeLevel);
        });
        
        // --- 1. URL 加载逻辑 ---
        function loadAudio() {
            const url = urlInput.value.trim();
            if (!url) {
                showToast("请输入有效的音频 URL。");
                return;
            }

            // 重置状态
            setControlsDisabled(true);
            audio.src = url;
            audio.load();
            currentAudioUrl = url;
            
            currentTrackTitleEl.textContent = '正在加载元数据...';
            progressBar.value = 0;
            timeDisplay.textContent = '0:00 / 0:00';

            showToast("音频链接已加载，等待元数据。");
        }

        // --- 2. 播放逻辑 (恢复) ---
        function togglePlayPause() {
            if (audio.paused) {
                audio.play();
                playPauseBtn.innerHTML = '⏸'; 
            } else {
                audio.pause();
                playPauseBtn.innerHTML = '▶';
            }
        }
        
        // --- 3. 时间和进度条同步逻辑 ---

        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) return "0:00";
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            const paddedSeconds = String(remainingSeconds).padStart(2, '0');
            return `${minutes}:${paddedSeconds}`;
        }

        // 音频元数据加载完成时
        audio.addEventListener('loadedmetadata', () => {
            progressBar.max = audio.duration;
            timeDisplay.textContent = `0:00 / ${formatTime(audio.duration)}`;
            currentTrackTitleEl.textContent = `加载成功：${formatTime(audio.duration)}`;
            setControlsDisabled(false); // 加载成功，启用控件
            playPauseBtn.innerHTML = '▶'; // 确保显示播放图标
        });

        // 监听加载错误
        audio.addEventListener('error', (e) => {
            console.error('音频加载错误:', e);
            showToast("音频加载失败，请检查 URL 或跨域设置(CORS)。");
            currentTrackTitleEl.textContent = '加载失败！';
            setControlsDisabled(true);
        });

        // 音频播放时，实时更新进度条和已播放时间
        audio.addEventListener('timeupdate', () => {
            progressBar.value = audio.currentTime; 
            
            // 进度条填充颜色
            const progress = (audio.currentTime / audio.duration) * 100;
            progressBar.style.background = `linear-gradient(to right, var(--primary-color) 0%, var(--primary-color) ${progress}%, var(--progress-track) ${progress}%, var(--progress-track) 100%)`;

            timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
        });

        // 音频播放结束
        audio.addEventListener('ended', () => {
            playPauseBtn.innerHTML = '▶'; 
            audio.currentTime = 0; 
            progressBar.value = 0;
        });

        // 用户拖动进度条，实现跳转播放
        progressBar.addEventListener('input', () => {
            audio.currentTime = progressBar.value; 
        });

        // --- 4. 事件绑定及辅助函数 ---
        loadBtn.addEventListener('click', loadAudio);
        playPauseBtn.addEventListener('click', togglePlayPause); // 重新启用播放按钮监听
        
        // 允许用户按 Enter 键加载 URL
        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadAudio();
            }
        });

        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.innerText = message;
            toast.className = "show";
            setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
        }
        
        // 页面加载时自动加载默认 URL
        document.addEventListener('DOMContentLoaded', loadAudio);
    </script>
</body>
</html>