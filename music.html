
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --player-bg-dark: #2a2a2a;
            --player-bg-light: #4c4c4c;
            --button-bg-color: #6a6a6a;
            --button-active-color: #929292;
            --led-color: #ff4500; /* OrangeRed for LED */
            --tape-window-bg: #1c1c1c;
            --tape-reel-color: #333;
            --tape-label-color: #eee;
            --tape-tape-color: #000;
            --accent-color: #007bff; /* Blue for highlights like progress */
            --font-pixel: 'Press Start 2P', cursive;
            --font-regular: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        body {
            font-family: var(--font-regular);
            background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        .cassette-player {
            background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5), inset 0 -5px 10px rgba(0, 0, 0, 0.6);
            width: 90%;
            max-width: 500px;
            text-align: center;
            border: 2px solid #555;
            position: relative;
            overflow: hidden;
        }
        /* --- é¡¶éƒ¨ä¿¡æ¯å’Œæ ‡é¢˜ --- */
        .player-header {
            margin-bottom: 20px;
        }
        .player-header h1 {
            font-family: var(--font-pixel);
            color: #eee;
            font-size: 1.5rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
        }
        .track-info h3 {
            font-family: var(--font-regular);
            color: #ccc;
            font-size: 0.9rem;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* --- ç£å¸¦çª—å£ --- */
        .tape-window {
            background-color: var(--tape-window-bg);
            border: 2px solid #555;
            border-radius: 5px;
            height: 120px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.7);
        }
        .tape-reel {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--tape-reel-color);
            border: 2px solid #666;
            position: relative;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .tape-reel::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 15px;
            height: 15px;
            background-color: #999;
            border-radius: 50%;
            border: 1px solid #777;
        }
        .tape-reel.playing {
            animation: rotateReel 0.5s linear infinite;
        }
        @keyframes rotateReel {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .tape-reel-tape {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--tape-tape-color);
            z-index: 1;
            overflow: hidden;
            transition: width 0.2s, height 0.2s;
        }
        /* --- æ¨¡æ‹Ÿç£å¸¦å¸¦ä½“ --- */
        .tape-strip {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 15px;
            background-color: var(--tape-tape-color);
            border-radius: 3px;
            z-index: 0;
        }
        .tape-strip::before, .tape-strip::after {
            content: '';
            position: absolute;
            top: -2px;
            bottom: -2px;
            width: 3px;
            background-color: #666;
            border-radius: 1px;
        }
        .tape-strip::before { left: 0; }
        .tape-strip::after { right: 0; }

        /* --- æ—¶é—´æ˜¾ç¤º (LED é£æ ¼) --- */
        #timeDisplay {
            font-family: var(--font-pixel);
            color: var(--led-color);
            background-color: #0d0d0d;
            border: 2px solid #555;
            padding: 8px 12px;
            margin: 0 auto 20px auto;
            border-radius: 4px;
            box-shadow: inset 0 0 8px rgba(255, 69, 0, 0.5), 0 0 5px rgba(255, 69, 0, 0.2);
            font-size: 1.1rem;
            width: fit-content;
            letter-spacing: 2px;
            text-shadow: 0 0 5px var(--led-color);
            display: block;
        }
        /* --- URL è¾“å…¥åŒºåŸŸ (V4: Load URL æŒ‰é’®ç•¥å¾®è°ƒæ•´æ ·å¼ä»¥åŒºåˆ†) --- */
        .url-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px; /* å‡å°é—´è· */
        }
        #audioUrlInput {
            flex-grow: 1;
            padding: 10px 15px;
            border: 2px solid #666;
            border-radius: 8px;
            background-color: #333;
            color: #eee;
            font-size: 0.9rem;
            outline: none;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
            transition: border-color 0.2s;
        }
        #audioUrlInput::placeholder {
            color: #aaa;
        }
        #audioUrlInput:focus {
            border-color: var(--accent-color);
        }
        #loadBtn {
            padding: 10px 20px;
            background: linear-gradient(to bottom, #444, #333);
            color: #fff;
            border: 2px solid #666;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 3px 0 #222, inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.1s ease;
            flex-shrink: 0;
            font-size: 0.9rem; /* è°ƒæ•´å­—ä½“å¤§å°ä»¥é€‚åº”ç©ºé—´ */
        }
        #loadBtn:active {
            box-shadow: 0 0 0 #222, inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: translateY(3px);
            background: linear-gradient(to top, #444, #333);
        }
        /* --- æœ¬åœ°æ–‡ä»¶æŒ‰é’® (ä½¿ç”¨ control-btn æ ·å¼) --- */
        .local-file-group {
            margin-bottom: 25px;
        }
        #openLocalFileBtn {
            /* ç»§æ‰¿ control-btn æ ·å¼ï¼Œä½†é¢œè‰²å¯ä»¥ç•¥æœ‰ä¸åŒ */
            background-color: #4a4a4a;
            border-color: #777;
            padding: 10px 10px; /* è°ƒæ•´å†…è¾¹è· */
            font-size: 1rem;
        }
        /* --- æ’­æ”¾å™¨æŒ‰é’®ç»„ --- */
        .player-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        /* é€šç”¨æŒ‰é’®æ ·å¼ä¿æŒä¸å˜ */
        .control-btn {
            background: linear-gradient(to bottom, var(--button-bg-color), #5a5a5a);
            color: #eee;
            border: 2px solid #888;
            border-radius: 8px;
            padding: 12px 10px;
            font-size: 1.2rem;
            cursor: pointer;
            text-transform: uppercase;
            font-weight: bold;
            box-shadow: 0 4px 0 #444, inset 0 1px 0 rgba(255, 255, 255, 0.15);
            transition: all 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .control-btn:active {
            box-shadow: 0 0 0 #444, inset 0 1px 0 rgba(255, 255, 255, 0.15);
            transform: translateY(4px);
            background: linear-gradient(to top, var(--button-bg-color), #5a5a5a);
        }
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: 0 4px 0 #444;
            transform: none;
        }
        /* Specific button colors/styles */
        #playBtn { background-color: #28a745; border-color: #38c755; }
        #playBtn:active { background-color: #1e7e34; }
        #playBtn:disabled { background-color: #28a745; opacity: 0.4;}
        #pauseBtn { background-color: #ffc107; border-color: #ffd117; color: #333; }
        #pauseBtn:active { background-color: #e0a800; }
        #pauseBtn:disabled { background-color: #ffc107; opacity: 0.4;}
        #stopBtn { background-color: #dc3545; border-color: #ff4555; }
        #stopBtn:active { background-color: #c82333; }
        #stopBtn:disabled { background-color: #dc3545; opacity: 0.4;}
        /* --- è¿›åº¦æ¡å’ŒéŸ³é‡ --- */
        .sliders-group { margin-top: 15px; }
        .slider-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .slider-wrapper label { color: #ccc; font-size: 0.8rem; width: 40px; text-align: right; flex-shrink: 0; }
        .custom-slider {
            -webkit-appearance: none; width: 100%; height: 8px; background: #444; border-radius: 4px; outline: none; transition: background 0.2s ease; box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: var(--accent-color); cursor: pointer; border: 2px solid #eee; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); transition: background 0.2s ease, transform 0.1s ease;
        }
        .custom-slider:disabled::-webkit-slider-thumb { background: #777; cursor: not-allowed;}

        #progressBar { background: linear-gradient(to right, var(--accent-color) 0%, var(--accent-color) 0%, #444 0%, #444 100%); }
        #volumeSlider { background: linear-gradient(to right, var(--accent-color) 0%, var(--accent-color) 100%, #444 100%, #444 100%); }
        /* Toast notifications */
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 12px; position: fixed; z-index: 1; bottom: 30px; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; }
        #toast.show { visibility: visible; opacity: 1; }
    </style>
</head>
<body>
    <div class="cassette-player">
        <div class="player-header">
            <div class="track-info">
                <h3 id="currentTrackTitle">åŠ è½½è‡ªå®šä¹‰éŸ³ä¹...</h3>
            </div>
        </div>
        <div class="tape-window">
            <div class="tape-reel left">
                 <div class="tape-reel-tape" id="tapeFillLeft"></div>
            </div>
            <div class="tape-strip"></div>
            <div class="tape-reel right">
                 <div class="tape-reel-tape" id="tapeFillRight"></div>
            </div>
        </div>
        <div id="timeDisplay">00:00 / 00:00</div>
        
        <div class="url-input-group">
            <input type="url" id="audioUrlInput" placeholder="è¾“å…¥éŸ³é¢‘ï¼ˆMP3/WAVï¼‰é“¾æ¥"
                   value="https://storage.googleapis.com/codeskulptor-assets/sound900.mp3"> 
            <button id="loadBtn">åŠ è½½ URL</button>
        </div>
        
        <div class="local-file-group">
            <input type="file" id="localFileInput" accept="audio/*" style="display: none;">
            <button id="openLocalFileBtn" class="control-btn" style="width: 100%;">
                ğŸ“‚ æ‰“å¼€æœ¬åœ°æ–‡ä»¶
            </button>
        </div>

        <audio id="audioPlayer"></audio>
        
        <div class="player-buttons">
            <button id="playBtn" class="control-btn">â–¶ æ’­æ”¾</button>
            <button id="pauseBtn" class="control-btn" disabled>â¸ æš‚åœ</button>
            <button id="stopBtn" class="control-btn" disabled>â–  åœæ­¢</button>
        </div>
        <div class="sliders-group">
            <div class="slider-wrapper">
                <label for="progressBar">è¿›åº¦</label>
                <input type="range" id="progressBar" class="custom-slider" value="0" min="0" max="100" disabled>
            </div>
            <div class="slider-wrapper">
                <label for="volumeSlider">éŸ³é‡</label>
                <input type="range" id="volumeSlider" class="custom-slider" min="0" max="100" value="100" disabled>
            </div>
        </div>
    </div>
    <div id="toast"></div>
    <script>
        // --- æ ¸å¿ƒå…ƒç´ å¼•ç”¨ ---
        const audio = document.getElementById('audioPlayer');
        const urlInput = document.getElementById('audioUrlInput');
        const loadBtn = document.getElementById('loadBtn');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const progressBar = document.getElementById('progressBar');
        const timeDisplay = document.getElementById('timeDisplay');
        const currentTrackTitleEl = document.getElementById('currentTrackTitle');
        const volumeSlider = document.getElementById('volumeSlider');
        
        // ç£å¸¦è½¬è½®å…ƒç´ 
        const tapeReelLeft = document.querySelector('.tape-reel.left');
        const tapeReelRight = document.querySelector('.tape-reel.right');
        const tapeFillLeft = document.getElementById('tapeFillLeft');
        const tapeFillRight = document.getElementById('tapeFillRight');
        
        // V4 æ–°å¢å¼•ç”¨
        const openLocalFileBtn = document.getElementById('openLocalFileBtn');
        const localFileInput = document.getElementById('localFileInput');

        let currentAudioUrl = '';
        let isPlaying = false; 

        // å¯ç”¨/ç¦ç”¨æ‰€æœ‰æ’­æ”¾å™¨æ§åˆ¶æŒ‰é’®
        function setControlsDisabled(disabled) {
            playBtn.disabled = disabled;
            pauseBtn.disabled = disabled;
            stopBtn.disabled = disabled;
            progressBar.disabled = disabled;
            volumeSlider.disabled = disabled;
        }

        // --- 0. éŸ³é‡åˆå§‹åŒ–åŠæ§åˆ¶ ---
        const savedVolume = localStorage.getItem('playerVolume');
        if (savedVolume !== null) {
            const initialVolume = parseFloat(savedVolume);
            audio.volume = initialVolume;
            volumeSlider.value = initialVolume * 100;
        } else {
            audio.volume = 1.0; 
        }

        volumeSlider.addEventListener('input', () => {
            const volumeLevel = volumeSlider.value / 100;
            audio.volume = volumeLevel;
            localStorage.setItem('playerVolume', volumeLevel);
            // æ›´æ–°éŸ³é‡æ»‘å—çš„å¡«å……é¢œè‰²
            const progress = volumeSlider.value;
            volumeSlider.style.background = `linear-gradient(to right, var(--accent-color) 0%, var(--accent-color) ${progress}%, #444 ${progress}%, #444 100%)`;
        });
        volumeSlider.dispatchEvent(new Event('input')); 

        // --- ç£å¸¦è½¬è½®åŠ¨ç”»æ§åˆ¶ ---
        function startTapeAnimation() {
            tapeReelLeft.classList.add('playing');
            tapeReelRight.classList.add('playing');
        }

        function stopTapeAnimation() {
            tapeReelLeft.classList.remove('playing');
            tapeReelRight.classList.remove('playing');
        }

        function updateTapeFill() {
            if (!audio.duration || isNaN(audio.duration) || audio.duration === Infinity) return;
            const progress = audio.currentTime / audio.duration; // 0 to 1
            const minSize = 20; 
            const maxSize = 40; 
            const leftFillDiameter = maxSize - (progress * (maxSize - minSize));
            const rightFillDiameter = minSize + (progress * (maxSize - minSize));

            tapeFillLeft.style.width = `${leftFillDiameter}px`;
            tapeFillLeft.style.height = `${leftFillDiameter}px`;
            tapeFillRight.style.width = `${rightFillDiameter}px`;
            tapeFillRight.style.height = `${rightFillDiameter}px`;
        }

        // --- 1. URL åŠ è½½é€»è¾‘ ---
        function loadAudio() {
            const url = urlInput.value.trim();
            if (!url) {
                showToast("è¯·è¾“å…¥æœ‰æ•ˆçš„éŸ³é¢‘ URLã€‚");
                return;
            }

            // æ¸…ç†å¹¶é‡ç½®çŠ¶æ€
            stopAudio(); 
            setControlsDisabled(true);
            
            // V4: ç¡®ä¿é‡Šæ”¾ä¸Šä¸€ä¸ªæœ¬åœ° URL
            if (audio.src && audio.src.startsWith('blob:')) {
                 URL.revokeObjectURL(audio.src);
            }

            // è®¾ç½®æ–°çš„æºå¹¶åŠ è½½
            audio.src = url;
            audio.load();
            currentAudioUrl = url;
            
            currentTrackTitleEl.textContent = 'æ­£åœ¨åŠ è½½å…ƒæ•°æ®...';
            progressBar.value = 0;
            timeDisplay.textContent = '00:00 / 00:00';
            updateTapeFill(); 

            showToast("éŸ³é¢‘é“¾æ¥å·²åŠ è½½ï¼Œç­‰å¾…å…ƒæ•°æ®...");
        }

        // V4 æ–°å¢ï¼šæœ¬åœ°æ–‡ä»¶åŠ è½½å‡½æ•°
        function loadLocalFile(file) {
            if (!file) {
                showToast("æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶ã€‚");
                return;
            }
            if (!file.type.startsWith('audio/')) {
                showToast("è¯·é€‰æ‹©ä¸€ä¸ªæœ‰æ•ˆçš„éŸ³é¢‘æ–‡ä»¶ (MP3, WAVç­‰)ã€‚");
                return;
            }

            // æ¸…ç†å¹¶é‡ç½®çŠ¶æ€
            stopAudio(); 
            setControlsDisabled(true);

            // ä½¿ç”¨ URL.createObjectURL åˆ›å»ºæœ¬åœ°æ–‡ä»¶çš„ URL
            const fileUrl = URL.createObjectURL(file);
            audio.src = fileUrl;
            audio.load();
            currentAudioUrl = fileUrl; 

            // æ›´æ–°æ ‡é¢˜ï¼Œæ˜¾ç¤ºæ–‡ä»¶å
            currentTrackTitleEl.textContent = `æ–‡ä»¶: ${file.name}`;
            progressBar.value = 0;
            timeDisplay.textContent = '00:00 / 00:00';
            updateTapeFill(); 

            showToast(`æœ¬åœ°æ–‡ä»¶ "${file.name}" å·²åŠ è½½ã€‚`);
        }
        
        // --- 2. æ’­æ”¾/æš‚åœ/åœæ­¢é€»è¾‘ (ä¿æŒä¸å˜) ---
        function playAudio() {
            if (audio.readyState >= 2) { 
                audio.play()
                    .then(() => {
                        isPlaying = true;
                        playBtn.disabled = true;
                        pauseBtn.disabled = false;
                        stopBtn.disabled = false;
                        startTapeAnimation();
                    })
                    .catch(e => {
                        console.error("æ’­æ”¾å¤±è´¥ (å¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’):", e);
                        showToast("æ’­æ”¾å¤±è´¥ï¼šæµè§ˆå™¨é™åˆ¶æˆ–èµ„æºé”™è¯¯ã€‚è¯·å†æ¬¡ç‚¹å‡»æ’­æ”¾æŒ‰é’®ã€‚");
                        playBtn.disabled = false; 
                    });
            } else { 
                 showToast("éŸ³é¢‘æ–‡ä»¶æœªå‡†å¤‡å¥½ï¼Œè¯·ç¨ç­‰æˆ–æ£€æŸ¥é“¾æ¥ã€‚");
            }
        }

        function pauseAudio() {
            if (!audio.paused) {
                audio.pause();
                isPlaying = false;
                playBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = false;
                stopTapeAnimation();
            }
        }

        function stopAudio() {
            audio.pause();
            audio.currentTime = 0;
            isPlaying = false;
            playBtn.disabled = false;
            pauseBtn.disabled = true;
            stopBtn.disabled = true;
            stopTapeAnimation();
            updateTapeFill(); 
            progressBar.value = 0;
            timeDisplay.textContent = `00:00 / ${formatTime(audio.duration)}`;
        }

        // --- 3. æ—¶é—´å’Œè¿›åº¦æ¡åŒæ­¥é€»è¾‘ (ä¿æŒä¸å˜) ---
        function formatTime(seconds) {
            if (isNaN(seconds) || seconds === Infinity || seconds < 0) return "00:00";
            const minutes = String(Math.floor(seconds / 60)).padStart(2, '0');
            const remainingSeconds = String(Math.floor(seconds % 60)).padStart(2, '0');
            return `${minutes}:${remainingSeconds}`;
        }

        audio.addEventListener('loadedmetadata', () => {
            if (audio.duration && audio.duration !== Infinity) {
                progressBar.max = audio.duration;
                timeDisplay.textContent = `00:00 / ${formatTime(audio.duration)}`;
                // å¦‚æœæ˜¯ä» URL åŠ è½½çš„ï¼Œåªæ˜¾ç¤ºæ—¶é•¿
                if (!currentTrackTitleEl.textContent.startsWith('æ–‡ä»¶:')) {
                    currentTrackTitleEl.textContent = `å·²åŠ è½½ (${formatTime(audio.duration)})`;
                }
                setControlsDisabled(false); 
                pauseBtn.disabled = true; 
                stopBtn.disabled = true; 
                updateTapeFill(); 
                showToast("åŠ è½½å®Œæˆï¼Œå¯ä»¥æ’­æ”¾äº†ã€‚");
            } else { 
                currentTrackTitleEl.textContent = `åŠ è½½æˆåŠŸ (æ—¶é•¿æœªçŸ¥)`;
                setControlsDisabled(false); 
                pauseBtn.disabled = true; 
                stopBtn.disabled = true; 
                progressBar.disabled = true; 
                timeDisplay.textContent = `00:00 / --:--`;
                showToast("éŸ³é¢‘åŠ è½½æˆåŠŸï¼Œä½†æ— æ³•è·å–æ—¶é•¿ä¿¡æ¯ã€‚");
            }
        });

        audio.addEventListener('error', (e) => {
            console.error('éŸ³é¢‘åŠ è½½é”™è¯¯:', e.target.error);
            let errorMessage = "éŸ³é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ URLã€‚";
            if (e.target.error.code === 4) { 
                 errorMessage = "åŠ è½½å¤±è´¥ï¼šæ–‡ä»¶ä¸å­˜åœ¨æˆ–æœåŠ¡å™¨é™åˆ¶ (CORS/404)ã€‚";
            }
            showToast(errorMessage);
            currentTrackTitleEl.textContent = 'åŠ è½½å¤±è´¥ï¼';
            setControlsDisabled(true);
            stopTapeAnimation();
        });

        audio.addEventListener('timeupdate', () => {
            if (audio.duration && audio.duration !== Infinity) {
                progressBar.value = audio.currentTime; 
                const progressPercentage = (audio.currentTime / audio.duration) * 100;
                progressBar.style.background = `linear-gradient(to right, var(--accent-color) 0%, var(--accent-color) ${progressPercentage}%, #444 ${progressPercentage}%, #444 100%)`;
                timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
                updateTapeFill(); 
            }
        });

        audio.addEventListener('ended', () => {
            stopAudio(); 
            showToast("æ’­æ”¾ç»“æŸã€‚");
        });

        progressBar.addEventListener('input', () => {
            audio.currentTime = progressBar.value; 
            updateTapeFill(); 
        });

        // --- 4. äº‹ä»¶ç»‘å®šåŠè¾…åŠ©å‡½æ•° (V4 æ–°å¢æœ¬åœ°æ–‡ä»¶ç»‘å®š) ---
        loadBtn.addEventListener('click', loadAudio);
        playBtn.addEventListener('click', playAudio);
        pauseBtn.addEventListener('click', pauseAudio);
        stopBtn.addEventListener('click', stopAudio);

        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadAudio();
            }
        });
        
        // V4 äº‹ä»¶ 1: ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œè§¦å‘éšè—çš„æ–‡ä»¶è¾“å…¥æ¡†
        openLocalFileBtn.addEventListener('click', () => {
            localFileInput.click();
        });

        // V4 äº‹ä»¶ 2: å½“æ–‡ä»¶è¾“å…¥æ¡†é€‰æ‹©æ–‡ä»¶åï¼Œè°ƒç”¨åŠ è½½å‡½æ•°
        localFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                // é‡Šæ”¾ä¸Šä¸€ä¸ªæœ¬åœ°æ–‡ä»¶çš„ URL (å¦‚æœæœ‰çš„è¯)
                if (audio.src && audio.src.startsWith('blob:')) {
                    URL.revokeObjectURL(audio.src);
                }
                loadLocalFile(file);
            }
            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥æ¡†çš„å€¼ï¼Œä»¥ä¾¿ä¸‹æ¬¡é€‰æ‹©ç›¸åŒæ–‡ä»¶ä¹Ÿèƒ½è§¦å‘ change äº‹ä»¶
            e.target.value = null; 
        });

        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.innerText = message;
            toast.className = "show";
            setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½é»˜è®¤ URL
        document.addEventListener('DOMContentLoaded', () => {
            setControlsDisabled(true); 
            loadAudio();
        });
    </script>
</body>
    </html>
