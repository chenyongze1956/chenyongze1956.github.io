
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        :root {
            --primary-color: #6366f1;
            --danger-color: #ef4444; /* 红色用于录制 */
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-color: #1f2937;
        }

        /* --- 整体布局与卡片样式 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .audio-card {
            background-color: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
                 background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff);

        }

        .status-area {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #f9fafb;
            min-height: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #statusText {
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 录音指示灯 */
        .recording-indicator {
            width: 10px;
            height: 10px;
            background-color: transparent;
            border-radius: 50%;
            animation: none;
        }

        .recording-indicator.active {
            background-color: var(--danger-color);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* 计时器样式 */
        #timer {
            margin-top: 5px;
            font-size: 0.9rem;
            color: #6b7280;
        }

        /* 隐藏原生 audio 元素 */
        audio { display: none; }

        /* --- 录音控制按钮 --- */
        .recording-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        /* 通用按钮样式 */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }
        
        /* 录音按钮 */
        #startStopBtn {
     background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff);
            color: white;
        }
        #startStopBtn:hover:not(:disabled) {
            background-color: #dc2626;
        }
        #startStopBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* 回放/下载/分享按钮容器 */
        .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* 回放按钮 */
        #playbackBtn {
          background-color: #e5e7eb;
            color: var(--text-color)
        }
        #playbackBtn:hover:not(:disabled) {
            background-color: #e5e7eb;
            color: var(--text-color)
        }
        #playbackBtn:disabled {
           background-color: #e5e7eb;
            color: var(--text-color)
        }

        /* 下载和分享按钮 */
        #downloadBtn, #shareBtn {
            background-color: #e5e7eb;
            color: var(--text-color);
        }
        #downloadBtn:hover:not(:disabled), #shareBtn:hover:not(:disabled) {
            background-color: #d1d5db;
        }

        /* 提示框 (Toast) 样式 */
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 12px; position: fixed; z-index: 1; bottom: 30px; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; }
        #toast.show { visibility: visible; opacity: 1; }
    </style>
</head>
<body>

    <div class="audio-card">
        <h1></h1>
        <p></p>
        
        <div class="status-area">
            <div id="statusText">
                <span id="indicator" class="recording-indicator"></span>
                等待开始
            </div>
            <div id="timer">00:00</div>
        </div>

        <audio id="audioPlayer"></audio>

        <div class="recording-controls">
            <button id="startStopBtn" class="btn">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7v0a7 7 0 01-7-7v0M12 19v2m0-17v1m6 0a6 6 0 00-12 0m10-2h4a2 2 0 012 2v4M2 10v4a2 2 0 002 2h4"></path></svg>
                开始录音
            </button>
        </div>

        <div class="action-buttons">
            <button id="playbackBtn" class="btn" disabled>
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197 2.132A1 1 0 0110 13.069V8.931a1 1 0 011.555-.832l3.197 2.132a1 1 0 010 1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                回放
            </button>
            
            <button id="downloadBtn" class="btn" disabled>
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                下载
            </button>

            <button id="shareBtn" class="btn" onclick="sharePageLink()">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                分享
            </button>
        </div>
    </div>

    <div id="toast"></div>

    <script>
        // --- 核心元素引用 ---
        const startStopBtn = document.getElementById('startStopBtn');
        const playbackBtn = document.getElementById('playbackBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const audioPlayer = document.getElementById('audioPlayer');
        const statusText = document.getElementById('statusText');
        const indicator = document.getElementById('indicator');
        const timerEl = document.getElementById('timer');

        // --- 录音状态管理 ---
        let mediaRecorder;
        let audioChunks = [];
        let audioBlob;
        let audioUrl;
        let recordingTimer;
        let seconds = 0;

        // --- 计时器辅助函数 ---
        function startTimer() {
            seconds = 0;
            timerEl.textContent = '00:00';
            recordingTimer = setInterval(() => {
                seconds++;
                const minutes = String(Math.floor(seconds / 60)).padStart(2, '0');
                const remainingSeconds = String(seconds % 60).padStart(2, '0');
                timerEl.textContent = `${minutes}:${remainingSeconds}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(recordingTimer);
        }

        // --- 1. 录音功能实现 ---

        async function startRecording() {
            try {
                // 请求麦克风权限
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // 初始化 MediaRecorder
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.start();
                audioChunks = []; // 重置音频块

                // 监听数据可用事件
                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                // 监听录音停止事件
                mediaRecorder.onstop = () => {
                    stopTimer();
                    
                    // 将所有音频块合并成一个 Blob 对象
                    audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    audioUrl = URL.createObjectURL(audioBlob);

                    // 停止麦克风流
                    stream.getTracks().forEach(track => track.stop());

                    // 启用回放和下载按钮
                    playbackBtn.disabled = false;
                    downloadBtn.disabled = false;
                    
                    // 更新 UI 状态
                    startStopBtn.innerHTML = '<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7v0a7 7 0 01-7-7v0M12 19v2m0-17v1m6 0a6 6 0 00-12 0m10-2h4a2 2 0 012 2v4M2 10v4a2 2 0 002 2h4"></path></svg> 开始录音';
                    startStopBtn.style.backgroundColor = 'var(--danger-color)';
                    statusText.innerHTML = '<span id="indicator" class="recording-indicator"></span> 录音完成';
                    indicator.classList.remove('active');
                    timerEl.textContent = `总时长: ${timerEl.textContent}`;
                };

                // 更新 UI 状态
                startStopBtn.innerHTML = '<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6"></path></svg> 停止录音';
                startStopBtn.style.backgroundColor = '#2563eb'; /* 蓝色表示正在工作 */
                statusText.innerHTML = '<span id="indicator" class="recording-indicator active"></span> 正在录音...';
                
                // 禁用旧的按钮
                playbackBtn.disabled = true;
                downloadBtn.disabled = true;

                startTimer();
                showToast("录音已开始，请说话");

            } catch (err) {
                console.error('无法获取麦克风:', err);
                statusText.innerHTML = '<span id="indicator" class="recording-indicator"></span> 权限被拒绝或麦克风不可用';
                alert('无法访问麦克风。请检查浏览器权限和 HTTPS 设置。');
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
        }

        // --- 2. 回放功能实现 ---
        function playbackRecording() {
            if (audioUrl) {
                audioPlayer.src = audioUrl;
                audioPlayer.play();
                showToast("正在回放录音");
                
                // 监听回放结束，更新按钮
                audioPlayer.onended = () => {
                    playbackBtn.innerHTML = '回放';
                };
                playbackBtn.innerHTML = '停止回放';
            }
        }
        
        // --- 3. 下载功能实现 ---
        function downloadRecording() {
            if (!audioBlob || !audioUrl) {
                showToast("请先录音");
                return;
            }

            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = audioUrl;
            // 使用时间戳作为文件名
            a.download = `recording-${new Date().getTime()}.webm`; 
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showToast("录音文件已开始下载");
        }

        // --- 4. 分享功能 (仅分享页面链接，因为不能直接分享本地录音文件) ---
        async function sharePageLink() {
            const shareData = {
                title: '我的在线录音机',
                text: '快来试试这个可以在线录音并下载的网页工具！',
                url: window.location.href 
            };

            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                } catch (err) {
                    console.error('分享取消或失败:', err);
                }
            } else {
                copyToClipboard(shareData.url);
            }
        }

        // --- 5. 事件绑定 ---
        startStopBtn.addEventListener('click', () => {
            // 根据当前 MediaRecorder 状态切换开始/停止
            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                startRecording();
            } else {
                stopRecording();
            }
        });

        playbackBtn.addEventListener('click', playbackRecording);
        downloadBtn.addEventListener('click', downloadRecording);

        // --- 6. 辅助函数 ---
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast("链接已复制到剪贴板！");
            }, () => {
                alert("复制失败，请手动复制链接");
            });
        }

        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.innerText = message;
            toast.className = "show";
            setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
        }
    </script>
</body>
</html>



<style>

    body{
     background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff);
}
    </style>
