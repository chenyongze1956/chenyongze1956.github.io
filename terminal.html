
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root { --bg: #0d0d0d; --text: #00ff41; --prompt: #00e5ff; --err: #ff3d00; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {      background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: 'Consolas', monospace; overflow: hidden; position: relative; }
        
        #snow-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; display: none; }

        #terminal { 
            background: rgba(13, 13, 13, 0.9); width: 100%; max-width: 1000px; height: 100%; 
            display: flex; flex-direction: column; position: relative; z-index: 2;
            transition: all 0.3s ease; backdrop-filter: blur(4px);
        }

        @media (min-width: 768px) { 
            #terminal { height: 90vh; border-radius: 12px; border: 1px solid #333; box-shadow: 0 20px 50px rgba(0,0,0,0.8); } 
        }

        #output { flex-grow: 1; overflow-y: auto; padding: 20px; line-height: 1.5; white-space: pre-wrap; word-break: break-all; color: var(--text); font-size: 14px; }
        #input-line { display: flex; align-items: flex-start; padding: 12px 20px; background: rgba(5, 5, 5, 1); border-top: 1px solid #222; }
        #prompt { color: var(--prompt); margin-right: 10px; font-weight: bold; white-space: nowrap; }
        #cmd-input { flex-grow: 1; background: transparent; border: none; color: var(--text); outline: none; font-size: 16px; font-family: inherit; width: 100%; }
        
        .success { color: #00e676; } .error { color: var(--err); } .welcome { color: #ffd600; }
        .hacker-text { color: #00ff41; font-weight: bold; text-shadow: 0 0 5px #00ff41; }
        .visualizer { display: flex; align-items: flex-end; height: 20px; gap: 3px; margin: 5px 0; }
        .bar { width: 4px; background: var(--text); animation: fluctuate 0.5s infinite alternate; }
        @keyframes fluctuate { from { height: 4px; } to { height: 20px; } }
    </style>
</head>
<body onclick="document.getElementById('cmd-input').focus()">
    <canvas id="snow-canvas"></canvas>
    <div id="terminal">
        <div id="output"></div>
        <div id="input-line">
            <span id="prompt">admin@web-cli:~$</span>
            <input type="text" id="cmd-input" spellcheck="false" autocomplete="off" autocapitalize="none">
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>
    <script>
        const output = document.getElementById('output');
        const input = document.getElementById('cmd-input');
        const promptText = document.getElementById('prompt');
        const terminal = document.getElementById('terminal');
        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');

        let state = {
            path: '/home/admin',
            files: ['README.txt', 'Documents/', 'Downloads/', 'music.mp3'],
            history: [], hIdx: -1, isMusicLocked: true, isChat: false,
            snowing: false, snowInterval: null
        };

        // --- é›ªèŠ±é€»è¾‘ ---
        let particles = [];
        function createSnow() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            particles = [];
            for(let i=0; i<100; i++) particles.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*3+1, d: Math.random()*1});
        }
        function drawSnow() {
            if(!state.snowing) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "white"; ctx.beginPath();
            particles.forEach(p => {
                ctx.moveTo(p.x, p.y); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
                p.y += Math.cos(p.d) + 1 + p.r/2; p.x += Math.sin(p.d) * 2;
                if(p.y > canvas.height) { p.y = -10; p.x = Math.random()*canvas.width; }
            });
            ctx.fill(); requestAnimationFrame(drawSnow);
        }

        const write = (txt, cls = '') => {
            const p = document.createElement('p'); p.className = cls;
            p.textContent = txt; output.appendChild(p);
            output.scrollTop = output.scrollHeight;
            return p;
        };

        const hackerWrite = async (lines) => {
            for (let line of lines) {
                await new Promise(r => setTimeout(r, 100));
                write(">> " + line, "hacker-text");
            }
        };

        const cmds = {
            'help': { desc: 'æŒ‡ä»¤åˆ—è¡¨', exec: () => {
                let list = 'ðŸ”§ ç³»ç»Ÿå¯ç”¨æŒ‡ä»¤:\n';
                Object.keys(cmds).sort().forEach(c => list += `  ${c.padEnd(12)} - ${cmds[c].desc}\n`);
                write(list);
            }},
            'ls': { desc: 'åˆ—å‡ºæ–‡ä»¶', exec: () => {
                const list = state.files.map(f => (f === 'music.mp3' && state.isMusicLocked) ? 'music.mp3(ðŸ”’)' : (f === 'music.mp3' ? 'music.mp3(ðŸŽµ)' : f));
                write(list.join('    ') || "(ç©ºç›®å½•)");
            }},
            'mkdir': { desc: 'åˆ›å»ºç›®å½•', exec: (a) => {
                const name = a[0] || 'new_folder';
                const dir = name.endsWith('/') ? name : name + '/';
                if(!state.files.includes(dir)) state.files.push(dir);
                write(`ç›®å½• ${dir} åˆ›å»ºæˆåŠŸã€‚`);
            }},
            'rmdir': { desc: 'åˆ é™¤ç›®å½•', exec: (a) => {
                const target = a[0] ? (a[0].endsWith('/') ? a[0] : a[0]+'/') : '';
                const idx = state.files.indexOf(target);
                if(idx > -1) { state.files.splice(idx, 1); write(`ç›®å½• ${target} å·²ç§»é™¤ã€‚`, "success"); }
                else write(`é”™è¯¯: ç›®å½• ${target} ä¸å­˜åœ¨`, "error");
            }},
            'touch': { desc: 'åˆ›å»ºæ–‡ä»¶', exec: (a) => {
                if(!a[0]) return write("ç¼ºå¤±æ–‡ä»¶å", "error");
                if(!state.files.includes(a[0])) state.files.push(a[0]);
                write(`æ–‡ä»¶ ${a[0]} åˆ›å»ºæˆåŠŸã€‚`);
            }},
            'rm': { desc: 'ç§»é™¤æ–‡ä»¶ (-r åˆ ç›®å½•)', exec: (a) => {
                let isR = a.includes('-r'); let name = a.find(i => !i.startsWith('-'));
                const match = state.files.find(f => f === name || f === name + '/');
                if(!match) return write("æ–‡ä»¶ä¸å­˜åœ¨", "error");
                if(match === 'music.mp3' && state.isMusicLocked) return write("ðŸš« æƒé™æ‹’ç»: æ–‡ä»¶è¢«é­”æ³•é”å®š", "error");
                if(match.endsWith('/') && !isR) return write("è¿™æ˜¯ä¸€ä¸ªç›®å½•ï¼Œè¯·ç”¨ rm -r", "error");
                state.files = state.files.filter(f => f !== match);
                write(`å·²åˆ é™¤ ${match}`);
            }},
            'cd': { desc: 'åˆ‡æ¢è·¯å¾„', exec: (a) => {
                state.path = a[0] || '/home/admin';
                promptText.textContent = `admin@web-cli:${state.path}$`;
                write(`å·²åˆ‡æ¢åˆ°: ${state.path}`);
            }},
            'pwd': { desc: 'å½“å‰è·¯å¾„', exec: () => write(state.path) },
            'clear': { desc: 'æ¸…å±', exec: () => { output.innerHTML = ''; writeWelcome(); }},
            'cast': { desc: 'å’’è¯­ (lumos/nox/alohomora)', exec: (a) => {
                const s = (a[0]||'').toLowerCase();
                if(s === 'alohomora') {
                    state.isMusicLocked = false;
                    write("ðŸ”“ å’’è¯­ç”Ÿæ•ˆ: music.mp3 å·²è§£é”!", "success");
                    cmds.ls.exec();
                } else if(s === 'lumos') {
                    terminal.style.boxShadow = '0 0 80px #00e5ff'; terminal.style.borderColor = '#00e5ff';
                    write("âœ¨ Lumos! ç»ˆç«¯å·²ç‚¹äº®ã€‚", "success");
                } else if(s === 'nox') {
                    terminal.style.boxShadow = '0 20px 50px black'; terminal.style.borderColor = '#333';
                    write("ðŸŒš Nox. å…‰äº®ç†„ç­ã€‚");
                } else write("å¯ç”¨: lumos, nox, alohomora");
            }},
            'chat': { desc: 'é»‘å®¢æ¨¡å¼', exec: () => { 
                state.isChat = true; promptText.textContent = "HACKER@SYS >"; 
                write("--- å»ºç«‹éš§é“: 127.0.0.1 -> SECRET_SRV ---", "success");
            }},
            'snow': { desc: 'ä¸‹é›ªæ•ˆæžœ (on/off)', exec: (a) => {
                if(a[0] === 'on') { state.snowing = true; canvas.style.display = 'block'; createSnow(); drawSnow(); write("â„ï¸ é™é›ªå¼€å§‹..."); }
                else { state.snowing = false; canvas.style.display = 'none'; write("â˜€ï¸ å¤©æ°”æ™´æœ—ã€‚"); }
            }},
            'qrterminal': { desc: 'ç”ŸæˆäºŒç»´ç ', exec: (a) => {
                if(!a[0]) return write("ç”¨æ³•: qrterminal å†…å®¹");
                const qr = qrcode(0, 'M'); qr.addData(a[0]); qr.make();
                const pre = document.createElement('pre'); pre.style.cssText="font-size:6px; line-height:1; letter-spacing:0;";
                let row = ''; const size = qr.getModuleCount();
                for (let r=0; r<size; r++) { for (let c=0; c<size; c++) row += qr.isDark(r,c) ? 'â–ˆâ–ˆ' : '  '; row += '\n'; }
                pre.textContent = row; output.appendChild(pre);
            }},
            'crypto': { desc: 'å¸ä»·', exec: () => write(`BTC: $${(96000 + Math.random()*1000).toFixed(2)} | ETH: $3421.50`) },
            'date': { desc: 'æ—¥æœŸ', exec: () => write(new Date().toString()) },
            'df': { desc: 'ç£ç›˜', exec: () => write("Filesystem     Used  Avail  Use%\n/dev/disk1s1   89G   120G   42%") },
            'display': { desc: 'å›¾ç‰‡', exec: (a) => {
                const img = document.createElement('img'); img.src = a[0]||'https://picsum.photos/200/100';
                img.style.maxWidth="200px"; img.style.marginTop="10px"; output.appendChild(img);
            }},
            'divine': { desc: 'å åœ', exec: () => write("ðŸ”® å¦è±¡æ˜¾ç¤º: å®œæ•²ä»£ç ï¼Œå¿Œä¿®Bugã€‚", "welcome") },
            'echo': { desc: 'å›žæ˜¾', exec: (a) => write(a.join(' ')) },
            'exit': { desc: 'é€€å‡º', exec: () => { document.body.innerHTML = '<h1 style="color:#00ff41;text-align:center;margin-top:20%">Terminal Session Ended.</h1>'; }},
            'fortune': { desc: 'éšæœº', exec: () => write("Fortune: Your code will compile on the first try.") },
            'fx': { desc: 'æ±‡çŽ‡', exec: () => write("1 USD = 7.2452 CNY | 1 JPY = 0.048 CNY") },
            'history': { desc: 'åŽ†å²', exec: () => write(state.history.join('\n')) },
            'linuxlogo': { desc: 'Logo', exec: () => write("  .---. \n / o o \\ \n \\  >  / \n  `---' \n Web-CLI v5.7") },
            'listen': { desc: 'é¢‘è°±', exec: () => {
                const d = document.createElement('div'); d.className='visualizer';
                for(let i=0; i<15; i++) d.innerHTML += `<div class="bar" style="animation-delay:${Math.random()}s"></div>`;
                output.appendChild(d);
            }},
            'ncat': { desc: 'æ‰«æ', exec: (a) => write(`Scanning ${a[0]||'localhost'}... Port 80: OPEN, Port 443: OPEN`) },
            'ping': { desc: 'æµ‹è¯•', exec: (a) => write(`PING ${a[0]||'google.com'} (142.250.190.46): 56 data bytes\n64 bytes: icmp_seq=0 ttl=116 time=14.2 ms`) },
            'pwgen': { desc: 'å¯†ç ', exec: () => write("Generated: " + Math.random().toString(36).slice(2, 12), "success") },
            'ruler': { desc: 'å°ºå­', exec: () => write("0...10...20...30...40...50...60...70...80") },
            'sl': { desc: 'ç«è½¦', exec: () => {
                let p=0; const l = write(""); 
                const i = setInterval(() => { l.textContent = " ".repeat(p) + "ðŸš‚ â–ˆâ–†â–„â–ƒ  "; p++; if(p>30) clearInterval(i); }, 100);
            }},
            'stock': { desc: 'è‚¡ä»·', exec: () => write("AAPL: $234.12 (+1.2%) | TSLA: $310.05 (-0.4%)") },
            'top': { desc: 'è¿›ç¨‹', exec: () => write("PID  COMMAND      %CPU  MEM\n1    init         0.0   2.1MB\n42   node_runtime 12.5  145MB") },
            'uname': { desc: 'å†…æ ¸', exec: () => write("Darwin Kernel Version 23.0.0: Web-Browser-JS-Edition") },
            'uptime': { desc: 'è¿è¡Œ', exec: () => write("up 4:23, 1 user, load averages: 1.24 1.02 0.98") },
            'whoami': { desc: 'å½“å‰ç”¨æˆ·', exec: () => write("admin") }
        };

        function writeWelcome() {
            write("", "");
            write("");
        }

        input.addEventListener('keydown', async (e) => {
            if (e.key === 'Enter') {
                const val = input.value.trim(); input.value = ''; if (!val) return;
                state.history.unshift(val);
                const l = document.createElement('p');
                l.innerHTML = `<span style="color:var(--prompt)">${promptText.textContent}</span> ${val}`;
                output.appendChild(l);
                
                if (state.isChat) {
                    if (val === '/quit') { state.isChat = false; promptText.textContent = `admin@web-cli:${state.path}$`; write("--- éš§é“å…³é—­ ---", "error"); }
                    else await hackerWrite(["åŠ å¯†é€šä¿¡ä¸­...", "å·²èŽ·å–æ•°æ®åŒ…: " + btoa(val).slice(0,12)]);
                    return;
                }
                const args = val.split(' ').filter(v => v !== "");
                const cmd = args.shift().toLowerCase();
                if (cmds[cmd]) cmds[cmd].exec(args); 
                else write(`-bash: ${cmd}: command not found`, 'error');
                output.scrollTop = output.scrollHeight;
            } else if (e.key === 'ArrowUp') {
                if (state.hIdx < state.history.length - 1) input.value = state.history[++state.hIdx];
            }
        });

        window.addEventListener('resize', () => { if(state.snowing) createSnow(); });
        writeWelcome(); input.focus();
    </script>
</body>
</html>
