
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Web Terminal CLI v5.4 - Full Edition</title>
    <style>
        :root { --bg: #0d0d0d; --text: #00ff41; --prompt: #00e5ff; --err: #ff3d00; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {      background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff);
 display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: 'Consolas', monospace; overflow: hidden; }
        
        #terminal { 
            background: var(--bg); 
            width: 100%; 
            max-width: 1000px; 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            position: relative;
            transition: box-shadow 0.5s ease, border-color 0.5s ease;
        }

        @media (min-width: 768px) { 
            #terminal { height: 90vh; border-radius: 12px; border: 1px solid #333; box-shadow: 0 20px 50px rgba(0,0,0,0.8); } 
        }

        #output { flex-grow: 1; overflow-y: auto; padding: 20px; line-height: 1.5; white-space: pre-wrap; word-break: break-all; color: var(--text); font-size: 14px; -webkit-overflow-scrolling: touch; }
        #input-line { display: flex; align-items: flex-start; padding: 12px 20px; background: #050505; border-top: 1px solid #222; padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
        #prompt { color: var(--prompt); margin-right: 10px; font-weight: bold; white-space: nowrap; font-size: 14px; }
        #cmd-input { flex-grow: 1; background: transparent; border: none; color: var(--text); outline: none; font-size: 16px; font-family: inherit; width: 100%; padding: 0; }
        
        /* Ê†∑ÂºèÁ±ª */
        .success { color: #00e676; } .error { color: var(--err); } .welcome { color: #ffd600; }
        .visualizer { display: flex; align-items: flex-end; height: 30px; gap: 4px; margin: 10px 0; }
        .bar { width: 5px; background: var(--text); animation: fluctuate 0.5s infinite alternate; }
        @keyframes fluctuate { from { height: 5px; } to { height: 30px; } }
    </style>
</head>
<body onclick="document.getElementById('cmd-input').focus()">
    <div id="terminal">
        <div id="output"></div>
        <div id="input-line">
            <span id="prompt">admin@web-cli:~$</span>
            <input type="text" id="cmd-input" spellcheck="false" autocomplete="off" autocapitalize="none">
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>
    <script>
        const output = document.getElementById('output');
        const input = document.getElementById('cmd-input');
        const promptText = document.getElementById('prompt');
        const terminal = document.getElementById('terminal');

        let state = {
            path: '/home/admin',
            files: ['README.txt', 'Documents/', 'Downloads/', 'music.mp3'],
            history: [], hIdx: -1, isMusicLocked: true, isChat: false, intervals: []
        };

        const write = (txt, cls = '') => {
            const p = document.createElement('p'); p.className = cls;
            p.textContent = txt; output.appendChild(p);
            setTimeout(() => { output.scrollTop = output.scrollHeight; }, 10);
            return p;
        };

        const stopAll = () => { state.intervals.forEach(clearInterval); state.intervals = []; };

        const cmds = {
            'help': { desc: 'ÊâÄÊúâÂëΩ‰ª§ÂàóË°®', exec: () => {
                let list = 'üîß Á≥ªÁªüÂèØÁî®Êåá‰ª§:\n';
                Object.keys(cmds).sort().forEach(c => list += `  ${c.padEnd(12)} - ${cmds[c].desc}\n`);
                write(list);
            }},
            'ls': { desc: 'ÂàóÂá∫Êñá‰ª∂', exec: () => {
                const display = state.files.map(f => (f==='music.mp3' && state.isMusicLocked) ? `${f}(üîí)` : f);
                write(display.join('  ') || "(Á©∫)");
            }},
            'mkdir': { desc: 'ÂàõÂª∫ÁõÆÂΩï', exec: (a) => {
                if(!a[0]) return write("mkdir: Áº∫Â§±ÂèÇÊï∞", "error");
                const dir = a[0].endsWith('/') ? a[0] : a[0] + '/';
                if(!state.files.includes(dir)) state.files.push(dir);
                write(`ÁõÆÂΩï '${dir}' ÂàõÂª∫ÊàêÂäü„ÄÇ`);
            }},
            'rmdir': { desc: 'Âà†Èô§ÁõÆÂΩï', exec: (a) => {
                if(!a[0]) return write("rmdir: Áº∫Â§±ÂèÇÊï∞", "error");
                const target = a[0].endsWith('/') ? a[0] : a[0] + '/';
                const idx = state.files.indexOf(target);
                if(idx === -1) return write(`rmdir: '${a[0]}' ÁõÆÂΩï‰∏çÂ≠òÂú®`, "error");
                state.files.splice(idx, 1);
                write(`ÁõÆÂΩï '${target}' Â∑≤ÁßªÈô§„ÄÇ`, "success");
            }},
            'touch': { desc: 'ÂàõÂª∫Êñá‰ª∂', exec: (a) => {
                if(!a[0]) return write("touch: Áº∫Â§±ÂèÇÊï∞", "error");
                if(!state.files.includes(a[0])) state.files.push(a[0]);
                write(`Êñá‰ª∂ '${a[0]}' Â∑≤ÂàõÂª∫„ÄÇ`);
            }},
            'rm': { desc: 'Âà†Èô§ (-r Âà†ÁõÆÂΩï)', exec: (a) => {
                let isR = a.includes('-r'); let name = a.find(i => !i.startsWith('-'));
                if(!name) return write("rm: Áº∫Â§±ÂèÇÊï∞", "error");
                const match = state.files.find(f => f === name || f === name + '/');
                if(!match) return write(`rm: '${name}' ‰∏çÂ≠òÂú®`, "error");
                if(match.endsWith('/') && !isR) return write("ËøôÊòØÁõÆÂΩïÔºåËØ∑‰ΩøÁî® -r", "error");
                if(match === 'music.mp3' && state.isMusicLocked) return write("ÊùÉÈôêÊãíÁªùÔºöÊñá‰ª∂Ë¢´ÈîÅÂÆö„ÄÇ", "error");
                state.files = state.files.filter(f => f !== match);
                write(`Â∑≤ÁßªÈô§ '${match}'„ÄÇ`);
            }},
            'cd': { desc: 'ÂàáÊç¢Ë∑ØÂæÑ', exec: (a) => { state.path = a[0] || '/home/admin'; promptText.textContent = `admin@web-cli:${state.path}$`; }},
            'pwd': { desc: 'ÊòæÁ§∫Ë∑ØÂæÑ', exec: () => write(state.path) },
            'whoami': { desc: 'ÂΩìÂâçÁî®Êà∑', exec: () => write('admin') },
            'clear': { desc: 'Ê∏ÖÁ©∫Â±èÂπï', exec: () => { output.innerHTML = ''; writeWelcome(); stopAll(); }},
            'date': { desc: 'Á≥ªÁªüÊó•Êúü', exec: () => write(new Date().toLocaleString()) },
            'echo': { desc: 'ÊâìÂç∞ÊñáÊú¨', exec: (a) => write(a.join(' ')) },
            'pwgen': { desc: 'ÈöèÊú∫ÂØÜÁ†Å', exec: () => write(Math.random().toString(36).slice(-10), "success") },
            'fortune': { desc: 'ÈöèÊú∫ÁÆ¥Ë®Ä', exec: () => write(["Stay Hungry, Stay Foolish.", "Code is Poetry."][Math.floor(Math.random()*2)], "welcome") },
            'linuxlogo': { desc: 'ÊòæÁ§∫Logo', exec: () => write("  .---. \n / o o \\ \n \\  >  / \n  `---' \nv5.4", "welcome") },
            'ping': { desc: 'ÁΩëÁªúÊµãËØï', exec: (a) => write(`64 bytes from ${a[0]||'8.8.8.8'}: seq=0 time=12ms`) },
            'curl': { desc: 'HTTPËØ∑Ê±Ç', exec: (a) => write(`GET ${a[0]||'localhost'}... 200 OK`) },
            'history': { desc: 'ÂëΩ‰ª§ÂéÜÂè≤', exec: () => write(state.history.slice(0, 10).join('\n')) },
            'crypto': { desc: 'Âä†ÂØÜÂ∏Å‰ª∑', exec: () => write(`BTC: $${(69000+Math.random()*500).toFixed(2)}`) },
            'stock': { desc: 'ÂÆûÊó∂ËÇ°‰ª∑', exec: () => write(`NVDA: $128.4 (+2.5%)`) },
            'divine': { desc: 'ÂÖ≠ÁàªÂç†Âçú', exec: () => write("„ÄêÂ§ßÂêâ„Äë‰ªäÊó•ÂÆúÂèëÂ∏É‰ª£Á†Å„ÄÇ", "welcome") },
            'sl': { desc: 'Â∞èÁÅ´ËΩ¶', exec: () => {
                let p=0; const line = write(""); 
                const i = setInterval(()=>{ line.textContent = " ".repeat(p)+"=OO=o-o- ÂëúÔºÅÔºÅ"; p++; if(p>40)clearInterval(i); }, 80); state.intervals.push(i);
            }},
            'cast': { desc: 'ÊñΩÊîæÂííËØ≠', exec: (a) => {
                const s = (a[0]||'').toLowerCase();
                if(s === 'alohomora') { state.isMusicLocked=false; write("üîì Ëß£ÈîÅÊàêÂäüÔºömusic.mp3 ÂèØËÆøÈóÆ„ÄÇ", "success"); }
                else if(s === 'lumos') { 
                    terminal.style.boxShadow = '0 0 80px rgba(0, 229, 255, 0.6)';
                    terminal.style.borderColor = '#00e5ff';
                    write("‚ú® ËçßÂÖâÈó™ÁÉÅÔºÅ", "success");
                }
                else if(s === 'nox') { 
                    terminal.style.boxShadow = '0 20px 50px rgba(0,0,0,0.8)';
                    terminal.style.borderColor = '#333';
                    write("üåö ËØ∫ÂÖãÊñØÔºÅ");
                }
                else write("ÂííËØ≠Ôºöalohomora / lumos / nox");
            }},
            'chat': { desc: 'AI ‰∫§‰∫í', exec: () => { state.isChat = true; promptText.textContent = "AI >"; write("üí¨ AI Â∑≤ËøûÊé•„ÄÇ/quit ÈÄÄÂá∫„ÄÇ"); }},
            'listen': { desc: 'ÂèØËßÜÂåñ', exec: () => {
                let bars = ''; for(let i=0; i<12; i++) bars += `<div class="bar" style="animation-delay: ${Math.random()}s"></div>`;
                const d = document.createElement('div'); d.className='visualizer'; d.innerHTML=bars; output.appendChild(d);
            }},
            'qrterminal': { desc: '‰∫åÁª¥Á†Å', exec: (a) => {
                if(!a[0]) return write("Áî®Ê≥ï: qrterminal ÂÜÖÂÆπ");
                const qr = qrcode(0, 'M'); qr.addData(a[0]); qr.make();
                let row = ''; const size = qr.getModuleCount();
                for (let r=0; r<size; r++) { for (let c=0; c<size; c++) row += qr.isDark(r,c) ? '‚ñà‚ñà' : '  '; row += '\n'; }
                const pre = document.createElement('pre'); pre.style.fontSize="6px"; pre.style.lineHeight="1"; pre.textContent = row; output.appendChild(pre);
            }},
            'df': { desc: 'Á£ÅÁõòÂç†Áî®', exec: () => write("Filesystem  Used  Available  Use%\n/dev/sda1   42G   158G       21%") },
            'top': { desc: 'ËøõÁ®ãÁõëÊéß', exec: () => write("PID  USER  %CPU  MEM  COMMAND\n101  admin 0.5   25M  node") },
            'uptime': { desc: 'ËøêË°åÊó∂Èó¥', exec: () => write("up 12 days, 4:23, 1 user") },
            'uname': { desc: 'Á≥ªÁªüÂÜÖÊ†∏', exec: () => write("Web-Linux 5.4-x86_64-JS") },
            'exit': { desc: 'ÈÄÄÂá∫Á≥ªÁªü', exec: () => { output.innerHTML = ''; write("Á≥ªÁªüÂ∑≤ÂÖ≥Èó≠„ÄÇ"); input.disabled=true; }},
            'ncat': { desc: 'Êâ´ÊèèÁ´ØÂè£', exec: (a) => write(`Scanning ${a[0]||'127.0.0.1'}... Port 80 OPEN.`) },
            'fx': { desc: 'Ê±áÁéáËΩ¨Êç¢', exec: () => write("1 USD = 7.24 CNY") },
            'display': { desc: 'ÂõæÁâáÊòæÁ§∫', exec: (a) => { const img = document.createElement('img'); img.src = a[0]||'https://picsum.photos/200/100'; img.style.maxWidth="100%"; output.appendChild(img); }},
            'ruler': { desc: 'ÂàªÂ∫¶Â∞∫', exec: () => write("0...10...20...30...40...50") }
        };

        function writeWelcome() {
            write("", "");
            write("");
        }

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const val = input.value.trim(); input.value = ''; if (!val) return;
                state.history.unshift(val); state.hIdx = -1;
                const l = document.createElement('p');
                l.innerHTML = `<span style="color:var(--prompt)">${promptText.textContent}</span> ${val}`;
                output.appendChild(l);
                
                if (state.isChat) {
                    if (val === '/quit') { state.isChat = false; promptText.textContent = `admin@web-cli:${state.path}$`; write("AI ‰∏ãÁ∫ø„ÄÇ"); }
                    else write("AI: Á≥ªÁªüÈÄªËæëÊ≠£Â∏∏ÔºåËØ∑ÁªßÁª≠Êìç‰Ωú„ÄÇ");
                    return;
                }
                const args = val.split(' ').filter(v => v !== "");
                const cmd = args.shift().toLowerCase();
                if (cmds[cmd]) cmds[cmd].exec(args); 
                else write(`-bash: ${cmd}: command not found.`, 'error');
                output.scrollTop = output.scrollHeight;
            } else if (e.key === 'ArrowUp') {
                if (state.hIdx < state.history.length - 1) input.value = state.history[++state.hIdx];
            }
        });

        window.visualViewport.addEventListener('resize', () => {
            document.body.style.height = window.visualViewport.height + 'px';
            output.scrollTop = output.scrollHeight;
        });

        writeWelcome();
        input.focus();
    </script>
</body>
</html>
