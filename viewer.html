
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è§‚ä¼—ç«¯ - å…¬ç½‘ç‰ˆ</title>
    <script src="peerjs.js"></script>
    <style>
        body { margin: 0;      background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff);
 color: #fff; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .video-box { flex: 1;     background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff);
; position: relative; display: flex; align-items: center; justify-content: center; }
        video { max-width: 100%; max-height: 100%; }
        #play-hint { position: absolute; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; cursor: pointer; z-index: 10; font-size: 1.2em; }
        .panel { padding: 20px; background: #222; border-top: 1px solid #444; }
        .emojis { display: flex; justify-content: space-around; font-size: 32px; cursor: pointer; margin-bottom: 15px; }
        .chat { display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; }
        button { background: #E91E63; border: none; padding: 0 20px; color: white; border-radius: 4px; cursor: pointer; font-weight: bold; }
        #status { text-align: center; color: #FFC107; font-size: 13px; margin-bottom: 10px; }
        .disabled { opacity: 0.3; pointer-events: none; }
    </style>
</head>
<body>
    <div class="video-box">
        <video id="remoteVideo" autoplay playsinline muted></video>
        <div id="play-hint" onclick="enableAudio()">ç‚¹å‡»å¼€å¯å£°éŸ³ ğŸ”Š</div>
    </div>
    <div class="panel">
        <div id="status">æ­£åœ¨å¯»æ‰¾å…¬ç½‘ä¿¡ä»¤æœåŠ¡å™¨...</div>
        <div id="ui" class="disabled">
            <div class="emojis">
                <span onclick="send('emoji', 'ğŸ”¥')">ğŸ”¥</span>
                <span onclick="send('emoji', 'ğŸ‘')">ğŸ‘</span>
                <span onclick="send('emoji', 'ğŸ˜‚')">ğŸ˜‚</span>
                <span onclick="send('emoji', 'ğŸ‘')">ğŸ‘</span>
            </div>
            <div class="chat">
                <input type="text" id="chatInput" placeholder="å‘æ¡å¼¹å¹•...">
                <button onclick="sendChat()">å‘é€</button>
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('remoteVideo');
        const status = document.getElementById('status');
        const hint = document.getElementById('play-hint');
        let dataConn = null, isStreamLoaded = false;

        // å…¬ç”¨é…ç½®
        const peerConfig = {
            host: '0.peerjs.com',
            port: 443,
            path: '/',
            secure: true,
            pingInterval: 5000,
            config: {
                'iceServers': [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { urls: 'stun:stun.anyfirewall.com:3478' }
                ]
            }
        };

        const peer = new Peer('VIEWER_' + Math.floor(Math.random() * 8999 + 1000), peerConfig);

        peer.on('open', id => {
            status.innerHTML = `âœ… æˆ‘çš„è§‚ä¼— ID: <b style="color:#00BCD4; font-size:16px;">${id}</b><br>(è¯·å‘é€ç»™ä¸»æ’­ï¼Œä¸è¦åˆ·æ–°æ­¤é¡µ)`;
        });

        peer.on('call', call => {
            call.answer();
            call.on('stream', stream => {
                if(isStreamLoaded) return;
                isStreamLoaded = true;
                video.srcObject = stream;
                video.play().then(() => { hint.style.display = 'flex'; });
            });
        });

        peer.on('connection', conn => {
            dataConn = conn;
            dataConn.on('open', () => {
                status.innerText = "âœ… äº’åŠ¨é€šé“å°±ç»ªï¼";
                document.getElementById('ui').classList.remove('disabled');
            });
        });

        peer.on('error', err => {
            status.innerText = "âŒ è¿æ¥å¼‚å¸¸: " + err.type;
        });

        function enableAudio() { video.muted = false; hint.style.display = 'none'; }
        function send(type, value) { if (dataConn && dataConn.open) dataConn.send({ type, value }); }
        function sendChat() {
            const input = document.getElementById('chatInput');
            if (input.value.trim()) { send('chat', input.value); input.value = ''; }
        }
    </script>
</body>
</html>
