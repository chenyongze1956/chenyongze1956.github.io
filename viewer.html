
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="peerjs.js"></script>
    <style>
        :root {
            --accent-color: #E91E63;
            --panel-bg: rgba(30, 30, 30, 0.95);
        }

        body { 
            margin: 0; 
            padding: 0;
            background: linear-gradient(45deg, #ff7e5f, #feb47b, #ffed86, #9feb8f, #5fbfff, #9b8eff);
            color: #fff; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            /* é€‚é…å…¨é¢å±åº•éƒ¨ */
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* è§†é¢‘å®¹å™¨ï¼šè‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´ */
        .video-box { 
            flex: 1; 
            position: relative; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            background: linear-gradient(45deg, #ff7e5f, #feb47b, #ffed86, #9feb8f, #5fbfff, #9b8eff);
            overflow: hidden;
        }

        video { 
            max-width: 100%; 
            max-height: 100%; 
            /* ä¿æŒæ¯”ä¾‹ä¸æ‹‰ä¼¸ */
            object-fit: contain; 
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* å£°éŸ³å¼€å¯æç¤º */
        #play-hint { 
            position: absolute; 
            inset: 0; 
            background: rgba(0,0,0,0.7); 
            display: none; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            z-index: 10; 
            backdrop-filter: blur(5px);
        }

        /* æ“ä½œé¢æ¿ */
        .panel { 
            padding: 15px 20px; 
            background: var(--panel-bg); 
            border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 20;
        }

        #status { 
            text-align: center; 
            color: #FFC107; 
            font-size: 13px; 
            margin-bottom: 12px;
            font-weight: 500;
        }

        .emojis { 
            display: flex; 
            justify-content: space-around; 
            margin-bottom: 15px; 
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

            #chatInput{

                color:#fff
                
            }

        /* è¡¨æƒ…æŒ‰é’®ä¼˜åŒ– */
        .emojis span { 
            font-size: 32px; 
            cursor: pointer; 
            padding: 8px;
            transition: transform 0.1s;
            /* ç¦æ­¢ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº®è“æ¡† */
            -webkit-tap-highlight-color: transparent; 
        }
        .emojis span:active { transform: scale(1.3); }

        .chat { 
            display: flex; 
            gap: 10px; 
            max-width: 600px;
            margin: 0 auto;
            color:#fff;
        }

        input { 
            flex: 1; 
            padding: 12px 16px; 
            background: #333; 
            color: #fff; 
            border: 1px solid #555; 
            border-radius: 25px; 
            font-size: 16px; /* 16pxå¯é˜²æ­¢iOSç‚¹å‡»è¾“å…¥æ¡†æ—¶è‡ªåŠ¨æ”¾å¤§é¡µé¢ */
            outline: none;
        }
        input:focus { border-color: var(--accent-color); }

        button { 
            background: var(--accent-color); 
            border: none; 
            padding: 0 20px; 
            color: white; 
            border-radius: 25px; 
            cursor: pointer; 
            font-weight: bold;
            transition: background 0.2s;
        }
        button:active { filter: brightness(0.8); }

        .disabled { opacity: 0.3; pointer-events: none; }

        /* é’ˆå¯¹å¤§å±ç”µè„‘çš„ä¼˜åŒ– */
        @media (min-width: 1024px) {
            .panel { padding: 25px; }
            .emojis span { font-size: 40px; }
            .chat { width: 400px; }
        }
    </style>
</head>
<body>
    <div class="video-box">
        <video id="remoteVideo" autoplay playsinline muted></video>
        <div id="play-hint" onclick="enableAudio()">
            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ”Š</div>
            <div style="font-size: 18px; font-weight: bold;">ç‚¹å‡»å¼€å¯å£°éŸ³</div>
            <div style="font-size: 12px; opacity: 0.6; margin-top: 5px;">(æµè§ˆå™¨ç­–ç•¥è¦æ±‚æ‰‹åŠ¨æ¿€æ´»éŸ³é¢‘)</div>
        </div>
    </div>

    <div class="panel">
        <div id="status">æ­£åœ¨å¯»æ‰¾å…¬ç½‘ä¿¡ä»¤æœåŠ¡å™¨...</div>
        
        <div id="ui" class="disabled">
            <div class="emojis">
                <span onclick="send('emoji', 'ğŸ”¥')" title="ç«çƒ­">ğŸ”¥</span>
                <span onclick="send('emoji', 'ğŸ‘')" title="ç‚¹èµ">ğŸ‘</span>
                <span onclick="send('emoji', 'ğŸ˜‚')" title="ç¬‘æ­»">ğŸ˜‚</span>
                <span onclick="send('emoji', 'ğŸ‘')" title="é¼“æŒ">ğŸ‘</span>
            </div>
            
            <div class="chat">
                <input type="text" id="chatInput" placeholder="å‘æ¡å¼¹å¹•äº’åŠ¨...">
                <button onclick="sendChat()">å‘é€</button>
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('remoteVideo');
        const status = document.getElementById('status');
        const hint = document.getElementById('play-hint');
        let dataConn = null, isStreamLoaded = false;

        // å…¬ç”¨é…ç½®
        const peerConfig = {
            host: '0.peerjs.com',
            port: 443,
            path: '/',
            secure: true,
            pingInterval: 5000,
            config: {
                'iceServers': [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { urls: 'stun:stun.anyfirewall.com:3478' }
                ]
            }
        };

        const peer = new Peer('VIEWER_' + Math.floor(Math.random() * 8999 + 1000), peerConfig);

        peer.on('open', id => {
            status.innerHTML = `âœ… æˆ‘çš„è§‚ä¼— ID: <b style="color:#00BCD4; font-size:16px;">${id}</b><br>(è¯·å‘é€ç»™ä¸»æ’­ï¼Œè¿æ¥åä¸è¦åˆ·æ–°)`;
        });

        peer.on('call', call => {
            call.answer();
            call.on('stream', stream => {
                if(isStreamLoaded) return;
                isStreamLoaded = true;
                video.srcObject = stream;
                
                // å°è¯•æ’­æ”¾å¹¶å¤„ç†é™éŸ³ç­–ç•¥
                video.play().then(() => {
                    // å¦‚æœè¢«è‡ªåŠ¨ç¦éŸ³ï¼Œæ˜¾ç¤ºæç¤º
                    if (video.muted) hint.style.display = 'flex';
                }).catch(() => {
                    hint.style.display = 'flex';
                });
            });
        });

        peer.on('connection', conn => {
            dataConn = conn;
            dataConn.on('open', () => {
                status.innerText = "âœ… äº’åŠ¨é€šé“å·²è¿æ¥ï¼Œå¼€å§‹å‘é€ç‰¹æ•ˆå§ï¼";
                document.getElementById('ui').classList.remove('disabled');
            });
        });

        peer.on('error', err => {
            status.innerText = "âŒ è¿æ¥å¼‚å¸¸: " + err.type;
        });

        function enableAudio() { 
            video.muted = false; 
            hint.style.display = 'none'; 
        }

        function send(type, value) { 
            if (dataConn && dataConn.open) {
                dataConn.send({ type, value }); 
                // ç®€å•çš„è§¦æ„Ÿåé¦ˆï¼ˆå¦‚æœè®¾å¤‡æ”¯æŒï¼‰
                if (window.navigator.vibrate) window.navigator.vibrate(10);
            } 
        }

        function sendChat() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (text) { 
                send('chat', text); 
                input.value = ''; 
                // æ‰‹æœºå‘é€åæ”¶èµ·é”®ç›˜ï¼Œé˜²æ­¢é®æŒ¡è§†é¢‘
                input.blur(); 
            }
        }
    </script>
</body>
</html>
