
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        .f-cyberpunk { filter: hue-rotate(-30deg) saturate(150%) contrast(120%); }
        .f-vivid { filter: saturate(200%) contrast(110%); }
        
        body {  
            background: linear-gradient(45deg,#ff7e5f,#feb47b,#ffed86,#9feb8f,#5fbfff,#9b8eff); 
            min-height: 100vh; 
            overflow: hidden; 
        }

        /* 扫描动画 */
        .scan-line {
            height: 2px;
            background: #3B82F6;
            box-shadow: 0 0 15px #3B82F6;
            position: absolute;
            width: 100%;
            top: -2px;
            z-index: 40;
            display: none;
            animation: scanning 2s linear infinite;
        }
        @keyframes scanning {
            0% { top: 0%; }
            50% { top: 100%; }
            100% { top: 0%; }
        }

        .camera-container { aspect-ratio: 9/16; max-height: 85vh; width: 100%; max-width: 400px; position: relative; }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4">

    <div class="camera-container rounded-3xl overflow-hidden shadow-2xl bg-black border-4 border-gray-800">
        <div id="scan-line" class="scan-line"></div>
        
        <div class="relative h-full">
            <video id="video" class="w-full h-full object-cover" autoplay muted playsinline style="transform: scaleX(-1);"></video>
            
            <div id="ai-status" class="absolute top-4 left-4 bg-black/50 backdrop-blur px-3 py-1 rounded-full text-[10px] flex items-center hidden">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse mr-2"></span>
                AI 年龄分析引擎已就绪
            </div>
            
            <div id="shutter-flash" class="absolute inset-0 bg-white opacity-0 pointer-events-none z-50"></div>
        </div>

        <div class="absolute bottom-0 inset-x-0 p-6 bg-gradient-to-t from-black/80 to-transparent">
            <div class="flex justify-between items-center">
                <button id="toggle-camera" class="text-white p-3 bg-white/10 rounded-full">
                    <i class="fa fa-refresh text-xl"></i>
                </button>
                
                <button id="capture-btn" class="relative group">
                    <div class="w-20 h-20 rounded-full border-4 border-white/30 flex items-center justify-center group-active:scale-95 transition-all">
                        <div class="w-16 h-16 rounded-full bg-white flex flex-col items-center justify-center text-black">
                            <i class="fa fa-eye text-lg"></i>
                            <span class="text-[8px] font-bold">AI识别</span>
                        </div>
                    </div>
                </button>
                
                <div class="w-12 h-12"></div> 
            </div>
        </div>
    </div>

    <div id="preview-modal" class="fixed inset-0 bg-black z-50 hidden flex flex-col items-center p-4">
        <div class="relative w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl">
            <img id="preview-image" class="w-full h-auto" alt="Captured Image">
            <div id="result-label" class="absolute top-10 left-1/2 -translate-x-1/2 bg-blue-600 text-white px-4 py-2 rounded-xl border-2 border-white shadow-lg font-bold">
                预测年龄: <span id="predicted-age">--</span> 岁
            </div>
        </div>
        
        <div class="mt-6 flex space-x-4 w-full max-w-sm">
            <button onclick="location.reload()" class="flex-1 bg-gray-800 py-3 rounded-xl font-bold text-white">重拍</button>
            <button id="save-btn" class="flex-1 bg-blue-600 py-3 rounded-xl font-bold text-white transition-colors">保存识别结果</button>
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const scanLine = document.getElementById('scan-line');
        const previewModal = document.getElementById('preview-modal');
        const previewImage = document.getElementById('preview-image');
        const saveBtn = document.getElementById('save-btn');
        let currentFacingMode = 'user';

        // 启动相机
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: currentFacingMode } 
                });
                video.srcObject = stream;
            } catch (err) {
                alert("无法访问摄像头，请确保页面在 HTTPS 下运行并已授权。");
            }
        }

        // 拍照并评估
        function captureAndAnalyze() {
            scanLine.style.display = 'block';
            
            setTimeout(() => {
                scanLine.style.display = 'none';
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                
                if(currentFacingMode === 'user') { 
                    ctx.translate(canvas.width, 0); 
                    ctx.scale(-1, 1); 
                }
                ctx.drawImage(video, 0, 0);

                // 随机预测年龄逻辑
                const predictedAge = Math.floor(Math.random() * (35 - 18 + 1)) + 18;
                document.getElementById('predicted-age').innerText = predictedAge;
                
                // 设置预览图
                previewImage.src = canvas.toDataURL('image/png');
                previewModal.classList.remove('hidden');
                
                if(navigator.vibrate) navigator.vibrate(50);
            }, 1500);
        }

        // 保存逻辑实现
        saveBtn.onclick = () => {
            const imageData = previewImage.src;
            if (!imageData) return;

            const link = document.createElement('a');
            link.href = imageData;
            link.download = `AI_Age_Selfie_${new Date().getTime()}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // 成功反馈
            const originalText = saveBtn.innerText;
            saveBtn.innerText = "✓ 已触发下载";
            saveBtn.classList.replace('bg-blue-600', 'bg-green-600');
            
            setTimeout(() => {
                saveBtn.innerText = originalText;
                saveBtn.classList.replace('bg-green-600', 'bg-blue-600');
            }, 2000);
        };

        document.getElementById('capture-btn').onclick = captureAndAnalyze;
        document.getElementById('toggle-camera').onclick = () => {
            currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
            startCamera();
        };

        window.onload = startCamera;
    </script>
</body>
</html>
